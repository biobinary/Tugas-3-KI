<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure Chat - DES with RSA</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons (opsional, untuk icon lebih bagus) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/script.js" defer></script>
</head>
<body>
  <div class="d-flex h-100 vh-100 overflow-hidden bg-dark text-white">
    <!-- Offcanvas Sidebar (mobile: slide-in, desktop: fixed sidebar) -->
    <div class="offcanvas offcanvas-start sidebar bg-dark" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarLabel">
      <div class="offcanvas-header border-bottom border-secondary">
        <h1 class="h5 mb-0 d-flex align-items-center gap-2">
          <span class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; font-size: 16px;">ğŸ”’</span>
          Secure Chat
        </h1>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>

      <div class="offcanvas-body p-3">
        <!-- Login Form -->
        <div id="login-section" class="login-form">
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input id="username" type="text" class="form-control" placeholder="Enter your username" autocomplete="username">
          </div>
          
          <button id="btnRegister" class="btn btn-success w-100 mb-3">
            <i class="bi bi-key"></i> Register & Generate Keys
          </button>

          <div class="alert alert-success" role="alert">
            <h6 class="alert-heading mb-2"><i class="bi bi-lock"></i> ğŸ” How It Works</h6>
            <ol class="mb-0 small">
              <li>Get RSA key pair (public & private)</li>
              <li>Public keys shared with all users</li>
              <li>Random DES key per message</li>
              <li>DES key encrypted with RSA</li>
              <li>Message encrypted with DES</li>
              <li>Decrypt with your private key</li>
            </ol>
          </div>
        </div>

        <!-- Keys Section -->
        <div id="keys-section" class="keys-section d-none">
          <div class="card mb-3 bg-secondary bg-opacity-25">
            <div class="card-body">
              <h6 class="card-title text-uppercase small text-muted mb-2"><i class="bi bi-unlock"></i> ğŸ”“ Public Key</h6>
              <div class="key-value d-flex justify-content-between align-items-start" id="publicKeyDisplay">
                <!-- Key text inserted here via JS -->
                <button class="btn btn-sm btn-outline-light copy-btn ms-auto" onclick="copyKey('publicKeyDisplay')"><i class="bi bi-clipboard"></i> Copy</button>
              </div>
            </div>
          </div>

          <div class="card mb-3 bg-danger bg-opacity-10 border-danger">
            <div class="card-body">
              <h6 class="card-title text-uppercase small text-danger mb-2"><i class="bi bi-lock"></i> ğŸ” Private Key</h6>
              <div class="key-value d-flex justify-content-between align-items-start" id="privateKeyDisplay">
                <!-- Key text inserted here via JS -->
                <button class="btn btn-sm btn-outline-danger copy-btn ms-auto" onclick="copyKey('privateKeyDisplay')"><i class="bi bi-clipboard"></i> Copy</button>
              </div>
              <small class="text-danger d-block mt-1">âš ï¸ Keep this private!</small>
            </div>
          </div>

          <div class="card user-badge bg-success bg-opacity-10 border-success mb-3">
            <div class="card-body d-flex align-items-center gap-3 p-2">
              <div class="user-avatar bg-success text-white rounded-circle d-flex align-items-center justify-content-center" id="userAvatar" style="width: 40px; height: 40px; font-size: 18px; font-weight: bold;">U</div>
              <div class="user-info">
                <strong id="me" class="d-block">Username</strong>
                <small class="text-success">â— Online</small>
              </div>
            </div>
          </div>

          <button id="btnLogout" class="btn btn-outline-secondary w-100">
            <i class="bi bi-door-open"></i> Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Main Chat Area -->
    <div class="flex-grow-1 d-flex flex-column overflow-hidden">
      <!-- Toggle Button for Mobile Sidebar -->
      <button class="btn btn-success position-absolute top-0 start-0 m-3 z-3 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas">
        <i class="bi bi-list"></i> Menu
      </button>

      <div id="chat-section" class="d-none flex-grow-1 d-flex flex-column h-100">
        <div class="p-3 border-bottom bg-light">
          <h2 class="h4 mb-2 d-flex align-items-center gap-2"><i class="bi bi-chat"></i> ğŸ’¬ Messages</h2>
          
          <div class="row g-2">
            <div class="col-12 col-md-6">
              <label for="users" class="form-label small">Send To</label>
              <select id="users" class="form-select"></select>
            </div>
            <div class="col-12">
              <div id="recipientKeyDisplay" class="recipient-info p-2 bg-light-subtle border rounded small"></div>
            </div>
          </div>
        </div>

        <div class="messages-area flex-grow-1 overflow-auto p-3" id="messagesArea">
          <div id="inbox" class="d-flex flex-column gap-2"></div>
        </div>

        <div class="p-3 border-top bg-light">
          <div class="compose-form">
            <div class="mb-2">
              <label for="message" class="form-label small">Your Message</label>
              <textarea id="message" class="form-control" placeholder="Type your message... (Ctrl+Enter to send)" rows="3"></textarea>
            </div>
            <button id="btnSend" class="btn btn-success">
              <i class="bi bi-send"></i> ğŸ“¤ Send
            </button>
          </div>
        </div>
      </div>

      <div id="empty-state" class="d-flex flex-column justify-content-center align-items-center h-100 text-center p-5">
        <div class="display-1 mb-3 opacity-50">ğŸ”’</div>
        <h3 class="h3 mb-2">Welcome to Secure Chat</h3>
        <p class="text-muted">Please register to start chatting securely</p>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function copyKey(elementId) {
      const element = document.getElementById(elementId);
      const button = element.querySelector('.copy-btn');
      const text = Array.from(element.childNodes)
        .filter(node => node.nodeType === Node.TEXT_NODE)
        .map(node => node.textContent.trim())
        .join('');
      
      navigator.clipboard.writeText(text).then(() => {
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="bi bi-check-lg"></i> Copied!';
        setTimeout(() => {
          button.innerHTML = originalText;
        }, 2000);
      });
    }
  </script>
</body>
</html>