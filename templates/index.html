<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure Chat - DES with RSA</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/script.js" defer></script>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>
          <span class="icon">ğŸ”’</span>
          Secure Chat
        </h1>
      </div>

      <div class="sidebar-content">
        <!-- Login Form -->
        <div id="login-section" class="login-form">
          <div class="form-group">
            <label>Username</label>
            <input id="username" type="text" placeholder="Enter your username" autocomplete="username">
          </div>
          
          <button id="btnRegister">
            ğŸ”‘ Register & Generate Keys
          </button>

          <div class="info-box">
            <h4>ğŸ” How It Works</h4>
            <ol>
              <li>Get RSA key pair (public & private)</li>
              <li>Public keys shared with all users</li>
              <li>Random DES key per message</li>
              <li>DES key encrypted with RSA</li>
              <li>Message encrypted with DES</li>
              <li>Decrypt with your private key</li>
            </ol>
          </div>
        </div>

        <!-- Keys Section -->
        <div id="keys-section" class="keys-section hidden">
          <div class="key-card">
            <h3>ğŸ”“ Public Key</h3>
            <div class="key-value" id="publicKeyDisplay">
              <button class="copy-btn" onclick="copyKey('publicKeyDisplay')">ğŸ“‹ Copy</button>
            </div>
          </div>

          <div class="key-card">
            <h3>ğŸ” Private Key</h3>
            <div class="key-value private" id="privateKeyDisplay">
              <button class="copy-btn" onclick="copyKey('privateKeyDisplay')">ğŸ“‹ Copy</button>
            </div>
            <small style="color: #fc8181; font-size: 11px; margin-top: 8px; display: block;">âš ï¸ Keep this private!</small>
          </div>

          <div class="user-badge">
            <div class="user-avatar" id="userAvatar">U</div>
            <div class="user-info">
              <strong id="me">Username</strong>
              <small>â— Online</small>
            </div>
          </div>

          <button id="btnLogout" class="btn-secondary">
            ğŸšª Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Main Chat Area -->
    <div class="main-area">
      <div id="chat-section" class="hidden" style="display: flex; flex-direction: column; height: 100%;">
        <div class="chat-header">
          <h2>ğŸ’¬ Messages</h2>
          
          <div class="recipient-select">
            <div class="form-group" style="margin: 0;">
              <label>Send To</label>
              <select id="users"></select>
            </div>
            <div id="recipientKeyDisplay" class="recipient-info"></div>
          </div>
        </div>

        <div class="messages-area" id="messagesArea">
          <div id="inbox"></div>
        </div>

        <div class="compose-area">
          <div class="compose-form">
            <div class="form-group" style="margin: 0;">
              <label>Your Message</label>
              <textarea id="message" placeholder="Type your message... (Ctrl+Enter to send)"></textarea>
            </div>
            <button id="btnSend" class="send-btn">
              ğŸ“¤ Send
            </button>
          </div>
        </div>
      </div>

      <div id="empty-state" class="empty-state">
        <div class="icon">ğŸ”’</div>
        <h3>Welcome to Secure Chat</h3>
        <p>Please register to start chatting securely</p>
      </div>
    </div>
  </div>

  <script>
    function copyKey(elementId) {
      const element = document.getElementById(elementId);
      const button = element.querySelector('.copy-btn');
      const text = Array.from(element.childNodes)
        .filter(node => node.nodeType === Node.TEXT_NODE)
        .map(node => node.textContent.trim())
        .join('');
      
      navigator.clipboard.writeText(text).then(() => {
        const originalText = button.innerHTML;
        button.innerHTML = 'âœ… Copied!';
        setTimeout(() => {
          button.innerHTML = originalText;
        }, 2000);
      });
    }
  </script>
</body>
</html>